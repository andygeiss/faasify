// Code generated by fassify DO NOT EDIT
package server

import (
	"embed"
    "io/fs"
	"net/http"
)

//go:embed bundle
var embedFS embed.FS

//go:generate go run ../../../cmd/update-functions/main.go

func router(cfg *config.Config) (mux *http.ServeMux) {
    // Init multiplexer
    mux = http.NewServeMux()

    // Set generated security token
    cfg.Token = "{{ .Token }}"
    cfg.AccountAccess.CreateAccount("faasify", "f44s1fy")

    // Add functions
    {{ range .Functions }}{{ if shouldBeSecure . }}mux.HandleFunc("/{{ . }}", WithAuthentication(cfg, WithLogging({{ . }}.HandlerFunc(cfg)))){{ end }}
    {{ end }}

    // Unsecure per default
    mux.HandleFunc("/index", WithLogging(index.HandlerFunc(cfg)))

    // Serve embedded files
    mux.HandleFunc("/", WithEmbeddedFiles(embedFS, "bundle"))
    return
}
